# ==========================
# 基礎設定
# ==========================

# Prefix 鍵設為 Ctrl-a（備用）
set -g prefix C-a
unbind C-b
bind C-a send-prefix

# 修正 Vim ESC 延遲
set -s escape-time 0
# 啟用滑鼠
set -g mouse on
# 歷史紀錄
set -g history-limit 50000
# 索引從 1 開始
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on

# True Color 支援
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

# 快速重載設定檔 (Prefix + r)
bind r source-file ~/.tmux.conf \; display "⚡ Config Reloaded!"

# 訊息顯示時間
set -g display-time 2000

# ==========================
# *** Alt 鍵極速操作區 ***
# ==========================

# --- 1. 視窗分割 ---
bind -n M-| split-window -h -c "#{pane_current_path}"
bind -n M-\\ split-window -h -c "#{pane_current_path}"
bind -n 'M--' split-window -v -c "#{pane_current_path}"
bind -n M-_ split-window -v -c "#{pane_current_path}"


# --- 2. Vim 風格導航 (Alt + h/j/k/l) ---
# 如果你使用 vim-tmux-navigator，可以註解掉這段改用插件
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R

# --- 3. 調整面板大小 (Alt + Shift + h/j/k/l) ---
bind -n M-H resize-pane -L 5
bind -n M-J resize-pane -D 5
bind -n M-K resize-pane -U 5
bind -n M-L resize-pane -R 5

# 或使用方向鍵調整大小
bind -n M-Left resize-pane -L 5
bind -n M-Right resize-pane -R 5
bind -n M-Up resize-pane -U 5
bind -n M-Down resize-pane -D 5

# --- 4. 視窗管理 ---
bind -n M-c new-window -c "#{pane_current_path}"
bind -n M-n next-window
bind -n M-p previous-window
bind -n M-q kill-pane

# 快速切換到指定視窗 (Alt + 數字)
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

# --- 5. 面板操作 ---
# 縮放當前面板 (專注模式)
bind -n M-z resize-pane -Z
# 交換面板位置
bind -n M-o swap-pane -D
# 切換面板佈局
bind -n M-Space next-layout

# ==========================
# 複製模式 (Vim 風格)
# ==========================
setw -g mode-keys vi

# 進入複製模式 (Prefix + v 或 Prefix + [)
bind v copy-mode
bind [ copy-mode

# Vim 風格選取和複製
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi C-v send -X rectangle-toggle
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "xclip -i -sel clip"
bind -T copy-mode-vi Enter send -X copy-pipe-and-cancel "xclip -i -sel clip"

# 貼上
bind p paste-buffer

# 複製模式中使用 Vim 搜尋
bind -T copy-mode-vi / command-prompt -i -p "search down" "send -X search-forward-incremental \"%%%\""
bind -T copy-mode-vi ? command-prompt -i -p "search up" "send -X search-backward-incremental \"%%%\""

# ==========================
# 視覺效果
# ==========================

# 面板邊框
set -g pane-border-style fg=colour240
set -g pane-active-border-style fg=colour33,bold

# 狀態列
set -g status-interval 1
set -g status-justify left
set -g status-style fg=white,bg=black

# 狀態列左側：顯示 session 名稱
set -g status-left-length 40
set -g status-left "#[fg=green,bold]❐ #S #[default]│ "

# 狀態列右側：顯示主機名和時間
set -g status-right-length 50
set -g status-right "#[fg=yellow] #[fg=cyan]%Y-%m-%d %H:%M:%S"
# 視窗狀態列樣式
setw -g window-status-style fg=white,bg=black
setw -g window-status-current-style fg=black,bg=yellow,bold
setw -g window-status-format " #I:#W "
setw -g window-status-current-format " #I:#W "

# 視窗活動提示
setw -g monitor-activity on
set -g visual-activity off

# ==========================
# 進階功能
# ==========================

# 保持當前路徑
bind c new-window -c "#{pane_current_path}"
bind '"' split-window -v -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"

# 快速選擇 session (Prefix + s 已內建，這裡加個 Alt 版本)
bind -n M-s choose-tree -Zs

# 快速同步所有面板輸入 (Prefix + e 切換)
bind e setw synchronize-panes \; display "Sync: #{?synchronize-panes,ON,OFF}"

# ==========================
# Vim-Tmux 無縫導航 (可選)
# ==========================
# 如果你安裝了 vim-tmux-navigator 插件，取消註解以下內容：

# is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
# bind -n M-h if-shell "$is_vim" "send-keys M-h" "select-pane -L"
# bind -n M-j if-shell "$is_vim" "send-keys M-j" "select-pane -D"
# bind -n M-k if-shell "$is_vim" "send-keys M-k" "select-pane -U"
# bind -n M-l if-shell "$is_vim" "send-keys M-l" "select-pane -R"
